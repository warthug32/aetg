/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function c(a){var b=a.children,c,d,e=a.children.length,f,g,h=/list-style-type:(.*?)(?:;|$)/,i=CKEDITOR.plugins.pastefromword.filters.stylesFilter;d=a.attributes;if(h.exec(d.style))return;for(var j=0;j<e;j++){c=b[j],c.attributes.value&&Number(c.attributes.value)==j+1&&delete c.attributes.value,f=h.exec(c.attributes.style);if(f){if(f[1]!=g&&!!g){g=null;break}g=f[1]}}if(g){for(j=0;j<e;j++)d=b[j].attributes,d.style&&(d.style=i([["list-style-type"]])(d.style)||"");a.addStyle("list-style-type",g)}}function n(a){a=a.toUpperCase();var b=l.length,c=0;for(var d=0;d<b;++d)for(var e=l[d],f=e[1].length;a.substr(0,f)==e[1];a=a.substr(f))c+=e[0];return c}function o(a){a=a.toUpperCase();var b=m.length,c=1;for(var d=1;a.length>0;d*=b)c+=m.indexOf(a.charAt(a.length-1))*d,a=a.substr(0,a.length-1);return c}var a=CKEDITOR.htmlParser.fragment.prototype,b=CKEDITOR.htmlParser.element.prototype;a.onlyChild=b.onlyChild=function(){var a=this.children,b=a.length,c=b==1&&a[0];return c||null},b.removeAnyChildWithName=function(a){var b=this.children,c=[],d;for(var e=0;e<b.length;e++){d=b[e];if(!d.name)continue;d.name==a&&(c.push(d),b.splice(e--,1)),c=c.concat(d.removeAnyChildWithName(a))}return c},b.getAncestor=function(a){var b=this.parent;while(b&&(!b.name||!b.name.match(a)))b=b.parent;return b},a.firstChild=b.firstChild=function(a){var b;for(var c=0;c<this.children.length;c++){b=this.children[c];if(a(b))return b;if(b.name){b=b.firstChild(a);if(b)return b}}return null},b.addStyle=function(a,b,c){var d=this,e,f="";if(typeof b=="string")f+=a+":"+b+";";else{if(typeof a=="object")for(var g in a)a.hasOwnProperty(g)&&(f+=g+":"+a[g]+";");else f+=a;c=b}d.attributes||(d.attributes={}),e=d.attributes.style||"",e=(c?[f,e]:[e,f]).join(";"),d.attributes.style=e.replace(/^;|;(?=;)/,"")},CKEDITOR.dtd.parentOf=function(a){var b={};for(var c in this)c.indexOf("$")==-1&&this[c][a]&&(b[c]=1);return b};var d=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,e=/^(?:\b0[^\s]*\s*){1,4}$/,f="^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$",g=new RegExp(f),h=new RegExp(f.toUpperCase()),i={decimal:/\d+/,"lower-roman":g,"upper-roman":h,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},j={disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/},k={ol:i,ul:j},l=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],m="ABCDEFGHIJKLMNOPQRSTUVWXYZ",p=0,q=null,r,s=CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(a,b){var c=new CKEDITOR.htmlParser.element("cke:listbullet");return c.attributes={"cke:listsymbol":a[0]},c.add(new CKEDITOR.htmlParser.text(b)),c},isListBulletIndicator:function(a){var b=a.attributes&&a.attributes.style;if(/mso-list\s*:\s*Ignore/i.test(b))return!0},isContainingOnlySpaces:function(a){var b;return(b=a.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(b.value)},resolveList:function(a){var b=a.attributes,c;return(c=a.removeAnyChildWithName("cke:listbullet"))&&c.length&&(c=c[0])?(a.name="cke:li",b.style&&(b.style=s.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(a){var c=a.split(" ");a=CKEDITOR.tools.convertToPx(c[3]||c[1]||c[0]),!p&&q!==null&&a>q&&(p=a-q),q=a,b["cke:indent"]=p&&Math.ceil(a/p)+1||1}],[/^mso-list$/,null,function(a){a=a.split(" ");var c=Number(a[0].match(/\d+/)),d=Number(a[1].match(/\d+/));d==1&&(c!==r&&(b["cke:reset"]=1),r=c),b["cke:indent"]=d}]])(b.style,a)||""),b["cke:indent"]||(q=0,b["cke:indent"]=1),CKEDITOR.tools.extend(b,c.attributes),!0):(r=q=p=null,!1)},getStyleComponents:function(){var a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);return CKEDITOR.document.getBody().append(a),function(b,c,d){a.setStyle(b,c);var e={},f=d.length;for(var g=0;g<f;g++)e[d[g]]=a.getStyle(d[g]);return e}}(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(a,b){b=typeof b=="number"?b:1;var c=a.attributes,e;switch(c.type){case"a":e="lower-alpha";break;case"1":e="decimal"}var f=a.children,g;for(var h=0;h<f.length;h++){g=f[h];if(g.name in CKEDITOR.dtd.$listItem){var i=g.attributes,j=g.children,k=j.length,l=j[k-1];l.name in CKEDITOR.dtd.$list&&(a.add(l,h+1),--j.length||f.splice(h--,1)),g.name="cke:li",c.start&&!h&&(i.value=c.start),s.filters.stylesFilter([["tab-stops",null,function(a){var b=a.split(" ")[1].match(d);b&&(q=CKEDITOR.tools.convertToPx(b[0]))}],b==1?["mso-list",null,function(a){a=a.split(" ");var b=Number(a[0].match(/\d+/));b!==r&&(i["cke:reset"]=1),r=b}]:null])(i.style),i["cke:indent"]=b,i["cke:listtype"]=a.name,i["cke:list-style-type"]=e}else if(g.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[g,b+1]),f=f.slice(0,h).concat(g.children).concat(f.slice(h+1)),a.children=[];for(var m=0,n=f.length;m<n;m++)a.add(f[m])}}delete a.name,c["cke:list"]=1},assembleList:function(a){var b=a.children,d,e,f,g,h,i,j,l=[],m,s,t,u,v,w;for(var x=0;x<b.length;x++){d=b[x];if("cke:li"==d.name){d.name="li",e=d,f=e.attributes,t=f["cke:listsymbol"],t=t&&t.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),u=v=w=null;if(f["cke:ignored"]){b.splice(x--,1);continue}f["cke:reset"]&&(j=h=i=null),g=Number(f["cke:indent"]),g!=h&&(s=m=null);if(!t)u=f["cke:listtype"]||"ol",v=f["cke:list-style-type"];else{if(s&&k[s][m].test(t[1]))u=s,v=m;else for(var y in k)for(var z in k[y])if(k[y][z].test(t[1])){if(y!="ol"||!/alpha|roman/.test(z)){u=y,v=z;break}var A=/roman/.test(z)?n(t[1]):o(t[1]);if(!w||A<w)w=A,u=y,v=z}!u&&(u=t[2]?"ol":"ul")}s=u,m=v||(u=="ol"?"decimal":"disc"),v&&v!=(u=="ol"?"decimal":"disc")&&e.addStyle("list-style-type",v);if(u=="ol"&&t){switch(v){case"decimal":w=Number(t[1]);break;case"lower-roman":case"upper-roman":w=n(t[1]);break;case"lower-alpha":case"upper-alpha":w=o(t[1])}e.attributes.value=w}if(!j)l.push(j=new CKEDITOR.htmlParser.element(u)),j.add(e),b[x]=j;else{if(g>h)l.push(j=new CKEDITOR.htmlParser.element(u)),j.add(e),i.add(j);else if(g<h){var B=h-g,C;while(B--&&(C=j.parent))j=C.parent;j.add(e)}else j.add(e);b.splice(x--,1)}i=e,h=g}else j&&(j=h=i=null)}for(x=0;x<l.length;x++)c(l[x]);j=h=i=r=q=p=null},falsyFilter:function(a){return!1},stylesFilter:function(a,b){return function(c,d){var e=[];(c||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(c,f,g){f=f.toLowerCase(),f=="font-family"&&(g=g.replace(/["']/g,""));var h,i,j,k;for(var l=0;l<a.length;l++)if(a[l]){h=a[l][0],i=a[l][1],j=a[l][2],k=a[l][3];if(f.match(h)&&(!i||g.match(i))){f=k||f,b&&(j=j||g),typeof j=="function"&&(j=j(g,d,f)),j&&j.push&&(f=j[0],j=j[1]),typeof j=="string"&&e.push([f,j]);return}}!b&&e.push([f,g])});for(var f=0;f<e.length;f++)e[f]=e[f].join(":");return e.length?e.join(";")+";":!1}},elementMigrateFilter:function(a,b){return function(c){var d=b?(new CKEDITOR.style(a,b))._.definition:a;c.name=d.element,CKEDITOR.tools.extend(c.attributes,CKEDITOR.tools.clone(d.attributes)),c.addStyle(CKEDITOR.style.getStyleText(d))}},styleMigrateFilter:function(a,b){var c=this.elementMigrateFilter;return function(d,e){var f=new CKEDITOR.htmlParser.element(null),g={};g[b]=d,c(a,g)(f),f.children=e.children,e.children=[f]}},bogusAttrFilter:function(a,b){if(b.name.indexOf("cke:")==-1)return!1},applyStyleFilter:null},getRules:function(a){var b=CKEDITOR.dtd,c=CKEDITOR.tools.extend({},b.$block,b.$listItem,b.$tableContent),d=a.config,f=this.filters,g=f.falsyFilter,h=f.stylesFilter,i=f.elementMigrateFilter,j=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),k=this.utils.createListBulletMarker,l=f.flattenList,m=f.assembleList,n=this.utils.isListBulletIndicator,o=this.utils.isContainingOnlySpaces,p=this.utils.resolveList,q=function(a){return a=CKEDITOR.tools.convertToPx(a),isNaN(a)?a:a+"px"},r=this.utils.getStyleComponents,s=this.utils.listDtdParents,t=d.pasteFromWordRemoveFontStyles!==!1,u=d.pasteFromWordRemoveStyles!==!1;return{elementNames:[[/meta|link|script/,""]],root:function(a){a.filterChildren(),m(a)},elements:{"^":function(a){var b;CKEDITOR.env.gecko&&(b=f.applyStyleFilter)&&b(a)},$:function(a){var e=a.name||"",f=a.attributes;e in c&&f.style&&(f.style=h([[/^(:?width|height)$/,null,q]])(f.style)||"");if(e.match(/h\d/)){a.filterChildren();if(p(a))return;i(d["format_"+e])(a)}else if(e in b.$inline)a.filterChildren(),o(a)&&delete a.name;else if(e.indexOf(":")!=-1&&e.indexOf("cke")==-1){a.filterChildren();if(e=="v:imagedata"){var g=a.attributes["o:href"];g&&(a.attributes.src=g),a.name="img";return}delete a.name}e in s&&(a.filterChildren(),m(a))},style:function(a){if(CKEDITOR.env.gecko){var b=a.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/),c=b&&b[1],d={};c&&(c.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(a,b,c){b=b.split(",");var e=b.length,f;for(var g=0;g<e;g++)CKEDITOR.tools.trim(b[g]).replace(/^(\w+)(\.[\w-]+)?$/g,function(a,b,e){b=b||"*",e=e.substring(1,e.length);if(e.match(/MsoNormal/))return;d[b]||(d[b]={}),e?d[b][e]=c:d[b]=c})}),f.applyStyleFilter=function(a){var b=d["*"]?"*":a.name,c=a.attributes&&a.attributes["class"],e;b in d&&(e=d[b],typeof e=="object"&&(e=e[c]),e&&a.addStyle(e,!0))})}return!1},p:function(a){if(/MsoListParagraph/.exec(a.attributes["class"])){var b=a.firstChild(function(a){return a.type==CKEDITOR.NODE_TEXT&&!o(a.parent)}),c=b&&b.parent,e=c&&c.attributes;e&&!e.style&&(e.style="mso-list: Ignore;")}a.filterChildren();if(p(a))return;d.enterMode==CKEDITOR.ENTER_BR?(delete a.name,a.add(new CKEDITOR.htmlParser.element("br"))):i(d["format_"+(d.enterMode==CKEDITOR.ENTER_P?"p":"div")])(a)},div:function(a){var b=a.onlyChild();if(b&&b.name=="table"){var c=a.attributes;b.attributes=CKEDITOR.tools.extend(b.attributes,c),c.style&&b.addStyle(c.style);var d=new CKEDITOR.htmlParser.element("div");d.addStyle("clear","both"),a.add(d),delete a.name}},td:function(a){a.getAncestor("thead")&&(a.name="th")},ol:l,ul:l,dl:l,font:function(a){if(n(a.parent)){delete a.name;return}a.filterChildren();var b=a.attributes,c=b.style,d=a.parent;"font"==d.name?(CKEDITOR.tools.extend(d.attributes,a.attributes),c&&d.addStyle(c),delete a.name):(c=c||"",b.color&&(b.color!="#000000"&&(c+="color:"+b.color+";"),delete b.color),b.face&&(c+="font-family:"+b.face+";",delete b.face),b.size&&(c+="font-size:"+(b.size>3?"large":b.size<3?"small":"medium")+";",delete b.size),a.name="span",a.addStyle(c))},span:function(a){if(n(a.parent))return!1;a.filterChildren();if(o(a))return delete a.name,null;if(n(a)){var b=a.firstChild(function(a){return a.value||a.name=="img"}),c=b&&(b.value||"l."),e=c&&c.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(e){var f=k(e,c),g=a.getAncestor("span");return g&&/ mso-hide:\s*all|display:\s*none /.test(g.attributes.style)&&(f.attributes["cke:ignored"]=1),f}}var i=a.children,l=a.attributes,m=l&&l.style,p=i&&i[0];return m&&(l.style=h([["line-height"],[/^font-family$/,null,t?null:j(d.font_style,"family")],[/^font-size$/,null,t?null:j(d.fontSize_style,"size")],[/^color$/,null,t?null:j(d.colorButton_foreStyle,"color")],[/^background-color$/,null,t?null:j(d.colorButton_backStyle,"color")]])(m,a)||""),null},b:i(d.coreStyles_bold),i:i(d.coreStyles_italic),u:i(d.coreStyles_underline),s:i(d.coreStyles_strike),sup:i(d.coreStyles_superscript),sub:i(d.coreStyles_subscript),a:function(a){var b=a.attributes;b&&!b.href&&b.name?delete a.name:CKEDITOR.env.webkit&&b.href&&b.href.match(/file:\/\/\/[\S]+#/i)&&(b.href=b.href.replace(/file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(a){a.getAncestor(/h\d/)&&!d.pasteFromWordNumberedHeadingToList&&delete a.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:h(u?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(a,b,c){if(b.name in{p:1,div:1}){var f=d.contentsLangDirection=="ltr"?"margin-left":"margin-right";if(c=="margin")a=r(c,a,[f])[f];else if(c!=f)return null;if(a&&!e.test(a))return[f,a]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(a,b){if(b.name=="img")return a}],[/^width|height$/,null,function(a,b){if(b.name in{table:1,td:1,th:1,img:1})return a}]]:[[/^mso-/],[/-color$/,null,function(a){if(a=="transparent")return!1;if(CKEDITOR.env.gecko)return a.replace(/-moz-use-text-color/g,"transparent")}],[/^margin$/,e],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],t?[/font-?/]:null],u),width:function(a,c){if(c.name in b.$tableContent)return!1},border:function(a,c){if(c.name in b.$tableContent)return!1},"class":g,bgcolor:g,valign:u?g:function(a,b){return b.addStyle("vertical-align",a),!1}},comment:CKEDITOR.env.ie?g:function(a,b){var c=a.match(/<img.*?>/),d=a.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(d){var e=d[1]||c&&"l.",f=e&&e.match(/>(?:[(]?)([^\s]+?)([.)]?)</);return k(f,e)}if(CKEDITOR.env.gecko&&c){var g=CKEDITOR.htmlParser.fragment.fromHtml(c[0]).children[0],h=b.previous,i=h&&h.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/),j=i&&i[1];return j&&(g.attributes.src=j),g}return!1}}}},t=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};t.prototype={toHtml:function(a){var b=CKEDITOR.htmlParser.fragment.fromHtml(a,!1),c=new CKEDITOR.htmlParser.basicWriter;return b.writeHtml(c,this.dataFilter),c.getHtml(!0)}},CKEDITOR.cleanWord=function(a,b){CKEDITOR.env.gecko&&(a=a.replace(/(<!--\[if[^<]*?\])-->([\S\s]*?)<!--(\[endif\]-->)/gi,"$1$2$3"));var c=new t,d=c.dataFilter;d.addRules(CKEDITOR.plugins.pastefromword.getRules(b)),b.fire("beforeCleanWord",{filter:d});try{a=c.toHtml(a,!1)}catch(e){alert(b.lang.pastefromword.error)}return a=a.replace(/cke:.*?".*?"/g,""),a=a.replace(/style=""/g,""),a=a.replace(/<span>/g,""),a}})();