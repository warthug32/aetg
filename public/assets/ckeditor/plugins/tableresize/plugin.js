/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function c(a){return CKEDITOR.env.ie?a.$.clientWidth:parseInt(a.getComputedStyle("width"),10)}function d(a,b){var c=a.getComputedStyle("border-"+b+"-width"),d={thin:"0px",medium:"1px",thick:"2px"};return c.indexOf("px")<0&&(c in d&&a.getComputedStyle("border-style")!="none"?c=d[c]:c=0),parseInt(c,10)}function e(a){var b=a.$.rows,c=0,d,e,f;for(var g=0,h=b.length;g<h;g++)f=b[g],d=f.cells.length,d>c&&(c=d,e=f);return e}function f(a){var b=[],c=-1,f=a.getComputedStyle("direction")=="rtl",g=e(a),h=new CKEDITOR.dom.element(a.$.tBodies[0]),i=h.getDocumentPosition();for(var j=0,k=g.cells.length;j<k;j++){var l=new CKEDITOR.dom.element(g.cells[j]),m=g.cells[j+1]&&new CKEDITOR.dom.element(g.cells[j+1]);c+=l.$.colSpan||1;var n,o,p,q=l.getDocumentPosition().x;f?o=q+d(l,"left"):n=q+l.$.offsetWidth-d(l,"right"),m?(q=m.getDocumentPosition().x,f?n=q+m.$.offsetWidth-d(m,"right"):o=q+d(m,"left")):(q=a.getDocumentPosition().x,f?n=q:o=q+a.$.offsetWidth),p=Math.max(o-n,3),b.push({table:a,index:c,x:n,y:i.y,width:p,height:h.$.offsetHeight,rtl:f})}return b}function g(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(b>=e.x&&b<=e.x+e.width)return e}return null}function h(a){(a.data||a).preventDefault()}function i(e){function q(){f=null,l=0,j=0,g.removeListener("mouseup",v),i.removeListener("mousedown",u),i.removeListener("mousemove",w),g.getBody().setStyle("cursor","auto"),b?i.remove():i.hide()}function r(){var a=f.index,b=CKEDITOR.tools.buildTableMap(f.table),d=[],e=[],q=Number.MAX_VALUE,r=q,s=f.rtl;for(var t=0,u=b.length;t<u;t++){var v=b[t],x=v[a+(s?1:0)],y=v[a+(s?0:1)];x=x&&new CKEDITOR.dom.element(x),y=y&&new CKEDITOR.dom.element(y);if(!x||!y||!x.equals(y))x&&(q=Math.min(q,c(x))),y&&(r=Math.min(r,c(y))),d.push(x),e.push(y)}m=d,n=e,o=f.x-q,p=f.x+r,i.setOpacity(.5),k=parseInt(i.getStyle("left"),10),l=0,j=1,i.on("mousemove",w),g.on("dragstart",h)}function s(){j=0,i.setOpacity(0),l&&t();var a=f.table;setTimeout(function(){a.removeCustomData("_cke_table_pillars")},0),g.removeListener("dragstart",h)}function t(){var b=f.rtl,e=b?n.length:m.length;for(var g=0;g<e;g++){var h=m[g],i=n[g],j=f.table;CKEDITOR.tools.setTimeout(function(c,d,e,f,g,h){c&&c.setStyle("width",a(Math.max(d+h,0))),e&&e.setStyle("width",a(Math.max(f-h,0))),g&&j.setStyle("width",a(g+h*(b?-1:1)))},0,this,[h,h&&c(h),i,i&&c(i),(!h||!i)&&c(j)+d(j,"left")+d(j,"right"),l])}}function u(a){h(a),r(),g.on("mouseup",v,this)}function v(a){a.removeListener(),s()}function w(a){x(a.data.$.clientX)}var f,g,i,j,k,l,m,n,o,p;g=e.document,i=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',g),b||g.getDocumentElement().append(i),this.attachTo=function(c){if(j)return;b&&(g.getBody().append(i),l=0),f=c,i.setStyles({width:a(c.width),height:a(c.height),left:a(c.x),top:a(c.y)}),b&&i.setOpacity(.25),i.on("mousedown",u,this),g.getBody().setStyle("cursor","col-resize"),i.show()};var x=this.move=function(b){if(!f)return 0;if(!j&&(b<f.x||b>f.x+f.width))return q(),0;var c=b-Math.round(i.$.offsetWidth/2);if(j){if(c==o||c==p)return 1;c=Math.max(c,o),c=Math.min(c,p),l=c-k}return i.setStyle("left",a(c)),1}}function j(a){var b=a.data.getTarget();if(a.name=="mouseout"){if(!b.is("table"))return;var c=new CKEDITOR.dom.element(a.data.$.relatedTarget||a.data.$.toElement);while(c&&c.$&&!c.equals(b)&&!c.is("body"))c=c.getParent();if(!c||c.equals(b))return}b.getAscendant("table",1).removeCustomData("_cke_table_pillars"),a.removeListener()}var a=CKEDITOR.tools.cssLength,b=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||CKEDITOR.env.version<7);CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],init:function(a){a.on("contentDom",function(){var b;a.document.getBody().on("mousemove",function(c){c=c.data;if(b&&b.move(c.$.clientX)){h(c);return}var d=c.getTarget(),e,m;if(!d.is("table")&&!d.getAscendant("tbody",1))return;e=d.getAscendant("table",1),(m=e.getCustomData("_cke_table_pillars"))||(e.setCustomData("_cke_table_pillars",m=f(e)),e.on("mouseout",j),e.on("mousedown",j));var n=g(m,c.$.clientX);n&&(!b&&(b=new i(a)),b.attachTo(n))})})}})})();