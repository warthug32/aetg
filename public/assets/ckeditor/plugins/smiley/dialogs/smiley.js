/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("smiley",function(a){var b=a.config,c=a.lang.smiley,d=b.smiley_images,e=b.smiley_columns||8,f,g,h=function(b){var c=b.data.getTarget(),d=c.getName();if(d=="a")c=c.getChild(0);else if(d!="img")return;var e=c.getAttribute("cke_src"),f=c.getAttribute("title"),h=a.document.createElement("img",{attributes:{src:e,"data-cke-saved-src":e,title:f,alt:f,width:c.$.width,height:c.$.height}});a.insertElement(h),g.hide(),b.data.preventDefault()},i=CKEDITOR.tools.addFunction(function(b,c){b=new CKEDITOR.dom.event(b),c=new CKEDITOR.dom.element(c);var d,e,f=b.getKeystroke(),g=a.lang.dir=="rtl";switch(f){case 38:if(d=c.getParent().getParent().getPrevious())e=d.getChild([c.getParent().getIndex(),0]),e.focus();b.preventDefault();break;case 40:if(d=c.getParent().getParent().getNext())e=d.getChild([c.getParent().getIndex(),0]),e&&e.focus();b.preventDefault();break;case 32:h({data:b}),b.preventDefault();break;case g?37:39:case 9:if(d=c.getParent().getNext())e=d.getChild(0),e.focus(),b.preventDefault(!0);else if(d=c.getParent().getParent().getNext())e=d.getChild([0,0]),e&&e.focus(),b.preventDefault(!0);break;case g?39:37:case CKEDITOR.SHIFT+9:if(d=c.getParent().getPrevious())e=d.getChild(0),e.focus(),b.preventDefault(!0);else if(d=c.getParent().getParent().getPrevious())e=d.getLast().getChild(0),e.focus(),b.preventDefault(!0);break;default:return}}),j=CKEDITOR.tools.getNextId()+"_smiley_emtions_label",k=['<div><span id="'+j+'" class="cke_voice_label">'+c.options+"</span>",'<table role="listbox" aria-labelledby="'+j+'" style="width:100%;height:100%" cellspacing="2" cellpadding="2"',CKEDITOR.env.ie&&CKEDITOR.env.quirks?' style="position:absolute;"':"","><tbody>"],l=d.length;for(f=0;f<l;f++){f%e===0&&k.push("<tr>");var m="cke_smile_label_"+f+"_"+CKEDITOR.tools.getNextNumber();k.push('<td class="cke_dark_background cke_centered" style="vertical-align: middle;"><a href="javascript:void(0)" role="option"',' aria-posinset="'+(f+1)+'"',' aria-setsize="'+l+'"',' aria-labelledby="'+m+'"',' class="cke_smile cke_hand" tabindex="-1" onkeydown="CKEDITOR.tools.callFunction( ',i,', event, this );">','<img class="cke_hand" title="',b.smiley_descriptions[f],'" cke_src="',CKEDITOR.tools.htmlEncode(b.smiley_path+d[f]),'" alt="',b.smiley_descriptions[f],'"',' src="',CKEDITOR.tools.htmlEncode(b.smiley_path+d[f]),'"',CKEDITOR.env.ie?" onload=\"this.setAttribute('width', 2); this.removeAttribute('width');\" ":"",'><span id="'+m+'" class="cke_voice_label">'+b.smiley_descriptions[f]+"</span>"+"</a>","</td>"),f%e==e-1&&k.push("</tr>")}if(f<e-1){for(;f<e-1;f++)k.push("<td></td>");k.push("</tr>")}k.push("</tbody></table></div>");var n={type:"html",id:"smileySelector",html:k.join(""),onLoad:function(a){g=a.sender},focus:function(){var a=this;setTimeout(function(){var b=a.getElement().getElementsByTag("a").getItem(0);b.focus()},0)},onClick:h,style:"width: 100%; border-collapse: separate;"};return{title:a.lang.smiley.title,minWidth:270,minHeight:120,contents:[{id:"tab1",label:"",title:"",expand:!0,padding:0,elements:[n]}],buttons:[CKEDITOR.dialog.cancelButton]}});