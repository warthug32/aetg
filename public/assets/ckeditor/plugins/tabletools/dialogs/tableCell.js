/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("cellProperties",function(a){function k(b,c){var d=function(){var a=this;f(a),c(a,a._.parentDialog),a._.parentDialog.changeFocus(!0)},e=function(){f(this),this._.parentDialog.changeFocus()},f=function(a){a.removeListener("ok",d),a.removeListener("cancel",e)},g=function(a){a.on("ok",d),a.on("cancel",e)};a.execCommand(b),a._.storedDialogs.colordialog?g(a._.storedDialogs.colordialog):CKEDITOR.on("dialogDefinition",function(a){if(a.data.name!=b)return;var c=a.data.definition;a.removeListener(),c.onLoad=CKEDITOR.tools.override(c.onLoad,function(a){return function(){g(this),c.onLoad=a,typeof a=="function"&&a.call(this)}})})}var b=a.lang.table,c=b.cell,d=a.lang.common,e=CKEDITOR.dialog.validate,f=/^(\d+(?:\.\d+)?)(px|%)$/,g=/^(\d+(?:\.\d+)?)px$/,h=CKEDITOR.tools.bind,i={type:"html",html:"&nbsp;"},j=a.lang.dir=="rtl";return{title:c.title,minWidth:CKEDITOR.env.ie&&CKEDITOR.env.quirks?450:410,minHeight:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?230:200,contents:[{id:"info",label:c.title,accessKey:"I",elements:[{type:"hbox",widths:["40%","5%","40%"],children:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["70%","30%"],children:[{type:"text",id:"width",width:"100px",label:d.width,validate:e.number(c.invalidWidth),onLoad:function(){var a=this.getDialog().getContentElement("info","widthType"),b=a.getElement(),c=this.getInputElement(),d=c.getAttribute("aria-labelledby");c.setAttribute("aria-labelledby",[d,b.$.id].join(" "))},setup:function(a){var b=parseInt(a.getAttribute("width"),10),c=parseInt(a.getStyle("width"),10);!isNaN(b)&&this.setValue(b),!isNaN(c)&&this.setValue(c)},commit:function(a){var b=parseInt(this.getValue(),10),c=this.getDialog().getValueOf("info","widthType");isNaN(b)?a.removeStyle("width"):a.setStyle("width",b+c),a.removeAttribute("width")},"default":""},{type:"select",id:"widthType",label:a.lang.table.widthUnit,labelStyle:"visibility:hidden","default":"px",items:[[b.widthPx,"px"],[b.widthPc,"%"]],setup:function(a){var b=f.exec(a.getStyle("width")||a.getAttribute("width"));b&&this.setValue(b[2])}}]},{type:"hbox",widths:["70%","30%"],children:[{type:"text",id:"height",label:d.height,width:"100px","default":"",validate:e.number(c.invalidHeight),onLoad:function(){var a=this.getDialog().getContentElement("info","htmlHeightType"),b=a.getElement(),c=this.getInputElement(),d=c.getAttribute("aria-labelledby");c.setAttribute("aria-labelledby",[d,b.$.id].join(" "))},setup:function(a){var b=parseInt(a.getAttribute("height"),10),c=parseInt(a.getStyle("height"),10);!isNaN(b)&&this.setValue(b),!isNaN(c)&&this.setValue(c)},commit:function(a){var b=parseInt(this.getValue(),10);isNaN(b)?a.removeStyle("height"):a.setStyle("height",CKEDITOR.tools.cssLength(b)),a.removeAttribute("height")}},{id:"htmlHeightType",type:"html",html:"<br />"+b.widthPx}]},i,{type:"select",id:"wordWrap",label:c.wordWrap,"default":"yes",items:[[c.yes,"yes"],[c.no,"no"]],setup:function(a){var b=a.getAttribute("noWrap"),c=a.getStyle("white-space");(c=="nowrap"||b)&&this.setValue("no")},commit:function(a){this.getValue()=="no"?a.setStyle("white-space","nowrap"):a.removeStyle("white-space"),a.removeAttribute("noWrap")}},i,{type:"select",id:"hAlign",label:c.hAlign,"default":"",items:[[d.notSet,""],[d.alignLeft,"left"],[d.alignCenter,"center"],[d.alignRight,"right"]],setup:function(a){var b=a.getAttribute("align"),c=a.getStyle("text-align");this.setValue(c||b||"")},commit:function(a){var b=this.getValue();b?a.setStyle("text-align",b):a.removeStyle("text-align"),a.removeAttribute("align")}},{type:"select",id:"vAlign",label:c.vAlign,"default":"",items:[[d.notSet,""],[d.alignTop,"top"],[d.alignMiddle,"middle"],[d.alignBottom,"bottom"],[c.alignBaseline,"baseline"]],setup:function(a){var b=a.getAttribute("vAlign"),c=a.getStyle("vertical-align");switch(c){case"top":case"middle":case"bottom":case"baseline":break;default:c=""}this.setValue(c||b||"")},commit:function(a){var b=this.getValue();b?a.setStyle("vertical-align",b):a.removeStyle("vertical-align"),a.removeAttribute("vAlign")}}]},i,{type:"vbox",padding:0,children:[{type:"select",id:"cellType",label:c.cellType,"default":"td",items:[[c.data,"td"],[c.header,"th"]],setup:function(a){this.setValue(a.getName())},commit:function(a){a.renameNode(this.getValue())}},i,{type:"text",id:"rowSpan",label:c.rowSpan,"default":"",validate:e.integer(c.invalidRowSpan),setup:function(a){var b=parseInt(a.getAttribute("rowSpan"),10);b&&b!=1&&this.setValue(b)},commit:function(a){var b=parseInt(this.getValue(),10);b&&b!=1?a.setAttribute("rowSpan",this.getValue()):a.removeAttribute("rowSpan")}},{type:"text",id:"colSpan",label:c.colSpan,"default":"",validate:e.integer(c.invalidColSpan),setup:function(a){var b=parseInt(a.getAttribute("colSpan"),10);b&&b!=1&&this.setValue(b)},commit:function(a){var b=parseInt(this.getValue(),10);b&&b!=1?a.setAttribute("colSpan",this.getValue()):a.removeAttribute("colSpan")}},i,{type:"hbox",padding:0,widths:["60%","40%"],children:[{type:"text",id:"bgColor",label:c.bgColor,"default":"",setup:function(a){var b=a.getAttribute("bgColor"),c=a.getStyle("background-color");this.setValue(c||b)},commit:function(a){var b=this.getValue();b?a.setStyle("background-color",this.getValue()):a.removeStyle("background-color"),a.removeAttribute("bgColor")}},{type:"button",id:"bgColorChoose","class":"colorChooser",label:c.chooseColor,onLoad:function(){this.getElement().getParent().setStyle("vertical-align","bottom")},onClick:function(){var a=this;k("colordialog",function(b){a.getDialog().getContentElement("info","bgColor").setValue(b.getContentElement("picker","selectedColor").getValue())})}}]},i,{type:"hbox",padding:0,widths:["60%","40%"],children:[{type:"text",id:"borderColor",label:c.borderColor,"default":"",setup:function(a){var b=a.getAttribute("borderColor"),c=a.getStyle("border-color");this.setValue(c||b)},commit:function(a){var b=this.getValue();b?a.setStyle("border-color",this.getValue()):a.removeStyle("border-color"),a.removeAttribute("borderColor")}},{type:"button",id:"borderColorChoose","class":"colorChooser",label:c.chooseColor,style:(j?"margin-right":"margin-left")+": 10px",onLoad:function(){this.getElement().getParent().setStyle("vertical-align","bottom")},onClick:function(){var a=this;k("colordialog",function(b){a.getDialog().getContentElement("info","borderColor").setValue(b.getContentElement("picker","selectedColor").getValue())})}}]}]}]}]}],onShow:function(){var a=this;a.cells=CKEDITOR.plugins.tabletools.getSelectedCells(a._.editor.getSelection()),a.setupContent(a.cells[0])},onOk:function(){var a=this,b=a._.editor.getSelection(),c=b.createBookmarks(),d=a.cells;for(var e=0;e<d.length;e++)a.commitContent(d[e]);b.selectBookmarks(c);var f=b.getStartElement(),g=new CKEDITOR.dom.elementPath(f);a._.editor._.selectionPreviousPath=g,a._.editor.fire("selectionChange",{selection:b,path:g,element:f})}}});