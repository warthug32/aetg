/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function a(a,b,c){if(!b.is||!b.getCustomData("block_processed"))b.is&&CKEDITOR.dom.element.setMarker(c,b,"block_processed",!0),a.push(b)}function b(a){var b=[],c=a.getChildren();for(var d=0;d<c.count();d++){var e=c.getItem(d);(e.type!==CKEDITOR.NODE_TEXT||!/^[ \t\n\r]+$/.test(e.getText()))&&b.push(e)}return b}function c(b,c){function f(a){var b=(new CKEDITOR.dom.elementPath(a)).elements,c;for(var e=0;e<b.length;e++)if(b[e].getName()in d){c=b[e];break}return c}function g(){this.foreach(function(a){/^(?!vbox|hbox)/.test(a.type)&&(a.setup||(a.setup=function(b){a.setValue(b.getAttribute(a.id)||"")}),a.commit||(a.commit=function(b){var c=this.getValue();if("dir"==a.id&&b.getComputedStyle("direction")==c)return;c?b.setAttribute(a.id,c):b.removeAttribute(a.id)}))})}function h(b){var c=[],f={},g=[],h,i=b.document.getSelection(),k=i.getRanges(),l=i.createBookmarks(),m,n,o=b.config.enterMode==CKEDITOR.ENTER_DIV?"div":"p";for(m=0;m<k.length;m++){n=k[m].createIterator();while(h=n.getNextParagraph())if(h.getName()in d){var p,q=h.getChildren();for(p=0;p<q.count();p++)a(g,q.getItem(p),f)}else{while(!e[h.getName()]&&h.getName()!="body")h=h.getParent();a(g,h,f)}}CKEDITOR.dom.element.clearAllMarkers(f);var r=j(g),s,t,u;for(m=0;m<r.length;m++){var v=r[m][0];s=v.getParent();for(p=1;p<r[m].length;p++)s=s.getCommonAncestor(r[m][p]);u=new CKEDITOR.dom.element("div",b.document);for(p=0;p<r[m].length;p++){v=r[m][p];while(!v.getParent().equals(s))v=v.getParent();r[m][p]=v}var w=null;for(p=0;p<r[m].length;p++){v=r[m][p];if(!v.getCustomData||!v.getCustomData("block_processed"))v.is&&CKEDITOR.dom.element.setMarker(f,v,"block_processed",!0),p||u.insertBefore(v),u.append(v)}CKEDITOR.dom.element.clearAllMarkers(f),c.push(u)}return i.selectBookmarks(l),c}function i(a){var b=new CKEDITOR.dom.elementPath(a.getSelection().getStartElement()),c=b.blockLimit,d=c&&c.getAscendant("div",!0);return d}function j(a){var b=[],c=null,d,e;for(var g=0;g<a.length;g++){e=a[g];var h=f(e);h.equals(c)||(c=h,b.push([])),b[b.length-1].push(e)}return b}function k(a){var c=this.getDialog(),d=c._element&&c._element.clone()||new CKEDITOR.dom.element("div",b.document);this.commit(d,!0),a=[].concat(a);var e=a.length,f;for(var g=0;g<e;g++)f=c.getContentElement.apply(c,a[g].split(":")),f&&f.setup&&f.setup(d,!0)}var d=function(){var a=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);return delete a.div,b.config.div_wrapTable&&(delete a.td,delete a.th),a}(),e=CKEDITOR.dtd.div,l={},m=[];return{title:b.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:b.lang.common.generalTab,title:b.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:b.lang.div.styleSelectLabel,"default":"",items:[[b.lang.common.notSet,""]],onChange:function(){k.call(this,["info:class","advanced:dir","advanced:style"])},setup:function(a){for(var b in l)l[b].checkElementRemovable(a,!0)&&this.setValue(b)},commit:function(a){var b;if(b=this.getValue()){var c=l[b],d=a.getCustomData("elementStyle")||"";c.applyToObject(a),a.setCustomData("elementStyle",d+c._.definition.attributes.style)}}},{id:"class",type:"text",label:b.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:b.lang.common.advancedTab,title:b.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",label:b.lang.common.id,"default":""},{type:"text",id:"lang",label:b.lang.link.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",style:"width: 100%;",label:b.lang.common.cssStyle,"default":"",commit:function(a){var b=this.getValue()+(a.getCustomData("elementStyle")||"");a.setAttribute("style",b)}}]},{type:"hbox",children:[{type:"text",id:"title",style:"width: 100%;",label:b.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",style:"width: 100%;",label:b.lang.common.langDir,"default":"",items:[[b.lang.common.notSet,""],[b.lang.common.langDirLtr,"ltr"],[b.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){g.call(this);var a=this,c=this.getContentElement("info","elementStyle");b.getStylesSet(function(b){var d;if(b)for(var e=0;e<b.length;e++){var f=b[e];f.element&&f.element=="div"&&(d=f.name,l[d]=new CKEDITOR.style(f),c.items.push([d,d]),c.add(d,d))}c[c.items.length>1?"enable":"disable"](),setTimeout(function(){c.setup(a._element)},0)})},onShow:function(){if(c=="editdiv"){var a=i(b);a&&this.setupContent(this._element=a)}},onOk:function(){c=="editdiv"?m=[this._element]:m=h(b,!0);var a=m.length;for(var d=0;d<a;d++)this.commitContent(m[d]),!m[d].getAttribute("style")&&m[d].removeAttribute("style");this.hide()},onHide:function(){c=="editdiv"&&this._element.removeCustomData("elementStyle"),delete this._element}}}CKEDITOR.dialog.add("creatediv",function(a){return c(a,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(a){return c(a,"editdiv")})})();